/**
 * web_scripts.h
 * JavaScript fÃ¼r Auto-Refresh, Theme-Toggle und Update-FunktionalitÃ¤t
 */

#ifndef WEB_SCRIPTS_H
#define WEB_SCRIPTS_H

#include <Arduino.h>

const char WEB_SCRIPTS_AUTO_REFRESH[] PROGMEM = R"=====(let autoRefreshEnabled=true;let refreshInterval=5000;let refreshTimer;function updateSensorData(){if(!autoRefreshEnabled)return;fetch('/sensors.json').then(r=>r.json()).then(data=>{updateTable(data);updateSystemStatus(data);updateSensorCount(data);}).catch(e=>{console.error('Error:',e);const s=document.getElementById('refresh-status');if(s){s.textContent='âœ— Error';s.style.color='var(--error-color)';}});}function updateTable(data){const t=document.getElementById('sensor-table');if(!t)return;const h=t.querySelector('thead tr');const b=document.getElementById('sensor-tbody');if(!h||!b)return;const hasTempCh2=data.sensors.some(s=>s.temp2!==null&&s.temp2!==undefined);const hasHumidity=data.sensors.some(s=>s.humi>0&&s.humi<=100);const hasWindSpeed=data.sensors.some(s=>s.wind_speed>0);const hasWindDir=data.sensors.some(s=>s.wind_direction!==null);const hasRain=data.sensors.some(s=>s.rain>0);const hasPower=data.sensors.some(s=>s.power>0);const hasPressure=data.sensors.some(s=>s.pressure>0);let hh='<th>ID</th><th>Type</th><th>Temperature</th>';if(hasTempCh2)hh+='<th>Temp Ch2</th>';if(hasHumidity)hh+='<th>Humidity</th>';if(hasWindSpeed)hh+='<th>Wind Speed</th>';if(hasWindDir)hh+='<th>Wind Dir</th>';if(hasRain)hh+='<th>Rain</th>';if(hasPower)hh+='<th>Power</th>';if(hasPressure)hh+='<th>Pressure</th>';hh+='<th>RSSI</th><th>Name</th><th>Age (ms)</th><th>Battery</th>';h.innerHTML=hh;b.innerHTML='';data.sensors.forEach(s=>{const r=b.insertRow();let rh=`<td>${s.id}</td><td>${s.type}</td><td>${s.temp} Â°C</td>`;if(hasTempCh2)rh+=`<td>${s.temp2!==null?s.temp2+' Â°C':'-'}</td>`;if(hasHumidity)rh+=`<td>${s.humi>0?s.humi+' %':'-'}</td>`;if(hasWindSpeed)rh+=`<td>${s.wind_speed>0?s.wind_speed+' m/s':'-'}</td>`;if(hasWindDir)rh+=`<td>${s.wind_direction||'-'}</td>`;if(hasRain)rh+=`<td>${s.rain>0?s.rain+' mm':'-'}</td>`;if(hasPower)rh+=`<td>${s.power>0?s.power+' W':'-'}</td>`;if(hasPressure)rh+=`<td>${s.pressure>0?s.pressure+' hPa':'-'}</td>`;rh+=`<td>${s.rssi}</td><td>${s.name||'-'}</td><td>${s.age}</td>`;const bc=s.batlo?'batt-weak':'batt-ok';const bt=s.batlo?'weak':'ok';rh+=`<td><span class="${bc}">${bt}</span></td>`;r.innerHTML=rh;});}function updateSystemStatus(data){const s=document.getElementById('system-status');if(!s)return;let h='';if(data.mqtt_ok)h+='<span class="status-badge status-ok">âœ“ MQTT Connected</span> ';else h+='<span class="status-badge status-error">âœ— MQTT Disconnected</span> ';if(data.wifi_ok)h+='<span class="status-badge status-ok">âœ“ WiFi Connected</span>';else h+='<span class="status-badge status-error">âœ— WiFi Disconnected</span>';s.innerHTML=h;}function updateSensorCount(data){const c=document.getElementById('sensor-count');if(!c)return;if(data.count===0)c.innerHTML='<em style="color:var(--secondary-text-color);">No sensors found. Waiting for data...</em>';else{const n=new Date().toLocaleTimeString();c.innerHTML=`<em style="color:var(--secondary-text-color);">Total sensors: <strong>${data.count}</strong> | Last update: ${n}</em>`;}}function toggleAutoRefresh(){autoRefreshEnabled=!autoRefreshEnabled;const b=document.getElementById('auto-refresh-btn');const s=document.getElementById('refresh-status');if(!b||!s)return;if(autoRefreshEnabled){b.textContent='â¸ï¸ Pause Auto-Refresh';b.style.backgroundColor='var(--warning-color)';s.textContent='â³ Active';s.style.color='var(--success-color)';startAutoRefresh();updateSensorData();}else{b.textContent='â–¶ï¸ Resume Auto-Refresh';b.style.backgroundColor='var(--success-color)';s.textContent='â¸ï¸ Paused';s.style.color='var(--warning-color)';if(refreshTimer)clearInterval(refreshTimer);}}function startAutoRefresh(){if(refreshTimer)clearInterval(refreshTimer);refreshTimer=setInterval(updateSensorData,refreshInterval);}function toggleTheme(){const body=document.body;const icon=document.getElementById('theme-icon');const text=document.getElementById('theme-text');if(!icon||!text)return;const t=body.getAttribute('data-theme');if(t==='light'){body.setAttribute('data-theme','dark');icon.textContent='ðŸŒ™';text.textContent='Dark Mode';localStorage.setItem('theme','dark');}else{body.setAttribute('data-theme','light');icon.textContent='â˜€ï¸';text.textContent='Light Mode';localStorage.setItem('theme','light');}}window.addEventListener('DOMContentLoaded',()=>{const t=localStorage.getItem('theme')||'dark';const icon=document.getElementById('theme-icon');const text=document.getElementById('theme-text');document.body.setAttribute('data-theme',t);if(icon&&text){if(t==='light'){icon.textContent='â˜€ï¸';text.textContent='Light Mode';}else{icon.textContent='ðŸŒ™';text.textContent='Dark Mode';}}startAutoRefresh();setTimeout(updateSensorData,1000);});)=====";

const char WEB_SCRIPTS_UPDATE[] PROGMEM = R"=====(function checkForUpdate(){const b=document.getElementById('check-update-btn');const d=document.getElementById('update-details');if(!b||!d)return;b.disabled=true;b.textContent='â³ Checking...';fetch('/check-update').then(r=>r.json()).then(data=>{b.disabled=false;b.textContent='Check for Updates';if(data.status==='success'&&data.available){d.style.display='block';const s=(data.fileSize/1024/1024).toFixed(2);d.innerHTML=`<div style="padding:16px;background:rgba(76,175,80,0.1);border-left:4px solid var(--success-color);border-radius:8px;margin-top:16px;"><p style="margin:4px 0;font-weight:600;color:var(--success-color);font-size:16px;">âœ“ New version available: ${data.latestVersion}</p><p style="margin:8px 0;font-size:13px;color:var(--secondary-text-color);">Size: ${s} MB</p><button onclick="installUpdate()" class="action-button" style="background:var(--success-color);margin-top:12px;">Install Update Now</button></div>`;}else if(data.status==='success'){d.style.display='block';d.innerHTML=`<div style="padding:16px;background:rgba(33,150,243,0.1);border-left:4px solid var(--info-color);border-radius:8px;margin-top:16px;"><p style="margin:0;color:var(--info-color);font-weight:500;">âœ“ You are running the latest version (${data.currentVersion})</p></div>`;}else{d.style.display='block';d.innerHTML=`<div style="padding:16px;background:rgba(244,67,54,0.1);border-left:4px solid var(--error-color);border-radius:8px;margin-top:16px;"><p style="margin:0;color:var(--error-color);">âœ— Error checking for updates: ${data.message||'Unknown error'}</p></div>`;}}).catch(e=>{b.disabled=false;b.textContent='Check for Updates';console.error('Error:',e);if(d){d.style.display='block';d.innerHTML=`<div style="padding:16px;background:rgba(244,67,54,0.1);border-left:4px solid var(--error-color);border-radius:8px;margin-top:16px;"><p style="margin:0;color:var(--error-color);">âœ— Network error</p></div>`;}});}function installUpdate(){if(!confirm('Device will restart. Continue?'))return;const d=document.getElementById('update-details');const p=document.getElementById('update-progress-container');if(d)d.style.display='none';if(p)p.style.display='block';const pb=document.getElementById('update-progress-bar');const pt=document.getElementById('update-progress-text');if(pb)pb.style.width='0%';if(pt)pt.textContent='Initializing...';fetch('/install-update',{method:'POST'}).then(r=>r.json()).then(data=>{if(data.status==='started'){const i=setInterval(()=>{fetch('/update-progress').then(r=>r.json()).then(p=>{if(pb)pb.style.width=p.progress+'%';if(pt)pt.textContent=`Downloading: ${p.progress}%`;if(!p.inProgress&&p.progress>=100){clearInterval(i);if(pt)pt.textContent='Complete! Rebooting...';setTimeout(()=>{window.location.href='/';},15000);}}).catch(e=>console.error('Error:',e));},1000);}}).catch(e=>{console.error('Error:',e);if(pt){pt.textContent='âœ— Error';pt.style.color='var(--error-color)';}});})=====" ;

#endif